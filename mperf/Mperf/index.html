<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mperf (mperf.Mperf)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc v2.3.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">mperf</a> &#x00BB; Mperf</nav><header class="odoc-preamble"><h1>Module <code><span>Mperf</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Attr"><a href="#module-Attr" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Attr/index.html">Attr</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-KindMap"><a href="#module-KindMap" class="anchor"></a><code><span><span class="keyword">module</span> KindMap</span><span> : <span class="xref-unresolved">Stdlib</span>.Map.S <span class="keyword">with</span> <span><span class="keyword">type</span> <span class="xref-unresolved">key</span> = <span class="xref-unresolved">Attr</span>.Kind.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-flag"><a href="#type-flag" class="anchor"></a><code><span><span class="keyword">type</span> flag</span><span> = </span></code><ol><li id="type-flag.Fd_cloexec" class="def variant constructor anchored"><a href="#type-flag.Fd_cloexec" class="anchor"></a><code><span>| </span><span><span class="constructor">Fd_cloexec</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>(since Linux 3.14). This flag enables the close-on-exec flag for the created event file descriptor, so that the file descriptor is automatically closed on execve(2). Setting the close-on-exec flags at creation time, rather than later with fcntl(2), avoids potential race conditions where the calling thread invokes perf_event_open() and fcntl(2) at the same time as another thread calls fork(2) then execve(2).</p><span class="comment-delim">*)</span></div></li><li id="type-flag.Fd_no_group" class="def variant constructor anchored"><a href="#type-flag.Fd_no_group" class="anchor"></a><code><span>| </span><span><span class="constructor">Fd_no_group</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This flag allows creating an event as part of an event group but having no group leader. It is unclear why this is useful.</p><span class="comment-delim">*)</span></div></li><li id="type-flag.Fd_output" class="def variant constructor anchored"><a href="#type-flag.Fd_output" class="anchor"></a><code><span>| </span><span><span class="constructor">Fd_output</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This flag reroutes the output from an event to the group leader.</p><span class="comment-delim">*)</span></div></li><li id="type-flag.Pid_cgroup" class="def variant constructor anchored"><a href="#type-flag.Pid_cgroup" class="anchor"></a><code><span>| </span><span><span class="constructor">Pid_cgroup</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>This flag activates per-container system-wide monitoring. A container is an abstraction that isolates a set of resources for finer-grained control (CPUs, memory, etc.). In this mode, the event is measured only if the thread running on the monitored CPU belongs to the designated container (cgroup). The cgroup is identified by passing a file descriptor opened on its directory in the cgroupfs filesystem. For instance, if the cgroup to monitor is called test, then a file descriptor opened on /dev/cgroup/test (assuming cgroupfs is mounted on /dev/cgroup) must be passed as the pid parameter. cgroup monitoring is available only for system-wide events and may therefore require extra permissions.</p><span class="comment-delim">*)</span></div></li></ol></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Opaque type of an event counter (internally <code>t</code> is a file descriptor). Each file descriptor corresponds to one event that is measured; these can be grouped together to measure multiple events simultaneously.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?pid</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?cpu</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?group</span>:<a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?flags</span>:<span><a href="#type-flag">flag</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="Attr/index.html#type-t">Attr.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>make ~pid ~cpu ?group ?flags attr</code> is a perf event counter. Refer to perf_event_open(2) for the description of the arguments. One counter only counts one kind of attribute at a time. If you want to simultanously count different metrics (like the perf stat tool does), you have to setup several counters.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-kind"><a href="#val-kind" class="anchor"></a><code><span><span class="keyword">val</span> kind : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="Attr/Kind/index.html#type-t">Attr.Kind.t</a></span></code></div><div class="spec-doc"><p><code>kind c</code> is the kind of events that this counter counts.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p><code>read c</code> is the value of the counter <code>c</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reset"><a href="#val-reset" class="anchor"></a><code><span><span class="keyword">val</span> reset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>reset c</code> sets <code>c</code> to zero.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enable"><a href="#val-enable" class="anchor"></a><code><span><span class="keyword">val</span> enable : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Start measuring.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable"><a href="#val-disable" class="anchor"></a><code><span><span class="keyword">val</span> disable : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Disabling an event. When an event is disabled it does not count or generate overflows but does continue to exist and maintain its count value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Free resources associated with a counter.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-execution"><a href="#type-execution" class="anchor"></a><code><span><span class="keyword">type</span> execution</span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-execution.process_status" class="def record field anchored"><a href="#type-execution.process_status" class="anchor"></a><code><span>process_status : <span class="xref-unresolved">Unix</span>.process_status;</span></code></li><li id="type-execution.stdout" class="def record field anchored"><a href="#type-execution.stdout" class="anchor"></a><code><span>stdout : string;</span></code></li><li id="type-execution.stderr" class="def record field anchored"><a href="#type-execution.stderr" class="anchor"></a><code><span>stderr : string;</span></code></li><li id="type-execution.data" class="def record field anchored"><a href="#type-execution.data" class="anchor"></a><code><span>data : <span><span class="xref-unresolved">Stdlib</span>.Int64.t <span class="xref-unresolved">KindMap</span>.t</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Type returned by <code>with_process</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_process"><a href="#val-with_process" class="anchor"></a><code><span><span class="keyword">val</span> with_process : 
  <span><span class="optlabel">?env</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?timeout</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stdout</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?stderr</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="Attr/index.html#type-t">Attr.t</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>[ <span>`Ok of <a href="#type-execution">execution</a></span> <span>| `Timeout</span> <span><span>| `Exn</span> of exn</span> ]</span></span></code></div><div class="spec-doc"><p><code>with_process ?env ?timeout ?stdout ?stderr cmd attrs</code> is the result of the execution of the program described by <code>cmd</code>. This can either be a successful execution, or an error.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enable_all"><a href="#val-enable_all" class="anchor"></a><code><span><span class="keyword">val</span> enable_all : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>A process can enable or disable all the event groups that are attached to it using the prctl(2) PR_TASK_PERF_EVENTS_ENABLE and PR_TASK_PERF_EVENTS_DISABLE operations. This applies to all counters on the calling process, whether created by this process or by another, and does not affect any counters that this process has created on other processes. It enables or disables only the group leaders, not any other members in the groups.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-disable_all"><a href="#val-disable_all" class="anchor"></a><code><span><span class="keyword">val</span> disable_all : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div></div></body></html>
